{%extends 'base.html'%}
{%load crispy_forms_tags%}
{%block content%}
    <script>
        async function fetchCount(event) {
            event.preventDefault();

            // Collect form data
            const formData = new FormData(event.target);
            const params = new URLSearchParams();

            for (const [key, value] of formData.entries()) {
                if (value) {
                    params.append(key, value);
                }
            }

            // Make API request
            const response = await fetch(`/get_count/?${params.toString()}`);
            const data = await response.json();

            // Display the result
            const resultDiv = document.getElementById('result');
            if (response.ok) {
                resultDiv.textContent = `Count: ${data.count}`;
            } else {
                resultDiv.textContent = `Error: ${data.error}`;
            }
        }
    </script>
    <h1>Filter Companies</h1>
<div class="content-section">
    <form id="filterForm" onsubmit="fetchCount(event)">
        {% csrf_token %}
        <fieldset class="form-group">
             <legend class="border-bottom-mb-4">Query Builder</legend>
        {{ form | crispy}}
        </fieldset>
        <div class="form-group">
                <button class="btn btn-outline-info" type="submit">Submit</button>
            </div>
    </form>
</div>
{%endblock content%}